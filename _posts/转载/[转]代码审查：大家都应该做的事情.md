Title: [转]代码审查：大家都应该做的事情

Date: 2011-11-11 09:56:37

URL: /2011/11/11/%e8%bd%ac%e4%bb%a3%e7%a0%81%e5%ae%a1%e6%9f%a5%ef%bc%9a%e5%a4%a7%e5%ae%b6%e9%83%bd%e5%ba%94%e8%af%a5%e5%81%9a%e7%9a%84%e4%ba%8b%e6%83%85/

Tags: 代码审查

正如我在上一篇博客中提到的（现在可以明确地告诉大家），我已经离开Google了。虽然我已经收到了很多不错的offer，但是还没有决定去哪里。在这段时间里从技术角度上说我不受雇于任何人，虽然也许这会让我和（前）同事或者老板关系有点紧张，但我觉得应该写一些关于技术上的有趣的事情。

正如我在上一篇博客中提到的（现在可以明确地告诉大家），我已经离开Google了。虽然我已经收到了很多不错的offer，但是还没有决定去哪里。在这段时间里从技术角度上说我不受雇于任何人，虽然也许这会让我和（前）同事或者老板关系有点紧张，但我觉得应该写一些关于技术上的有趣的事情。  

 Google确实是一家很酷的公司。不论是在公司内部或是外部，Google都做了很多让人赞叹的的事情。这里我想介绍一些不涉及商业机密，但鲜为外人所知的事情。   

 Google的代码之所以优秀原因其实很简单：**他们非常重视代码审查**。代码审查并不是Google独有的，它被公认为是一个很好的（提高代码质量的）手段，很多人已经在日常开发中采用代码审查。但我还没有看到哪一家大公司（像Google这样）应用得如此广泛。在 Google，任何的产品或者项目代码在检入（代码仓库）之前都需要进行有效的审查。   

 每个人都要参与代码审查，而且这里我指的不是非正式的审查：**它是软件开发环节中非常重要而且通用的规则**。不仅是产品代码，所有的代码都需要进行审查。审查代码不需要投入很多的精力，但是（与不做审查相比）产生的效果却是天壤之别。   

 关于代码审查（code review），Jonathan Danylko 的看法是“[代码要经常检查（包括自查和其他同事检查）](http://www.jobbole.com/entry.php/322)。不要把别人的检查，看成是对代码风格的苛求。应该把它们看作是有建设性的批评。对个人来说，经常检查你的代码并且自问，“我怎样才能写得更好呢？” 这会加速你的成长，让你成为一个更优秀的程序员。”   

**你能从代码审查中收获什么？**   

 事实显而易见，有另外一个人检查即将提交的代码，能够帮助找到bug。这是代码审查众所周知且经常被提及的好处。但依据我的经验，这是最没有价值的一个好处。人们确实可以在代码审查中找到bug。然而坦率地说，在代码审查中找到的bug绝大多数都是一些代码作者花上几分钟就能找到的小bug。那些真正需要花时间才能找到的bug在代码审查中是检查不到的。   

**代码审查最大的好处在于它是一种社交的途径。**如果你编程的时候就知道会有同事检查你的代码，那么你的程序会有所不同。你写的代码会更加整洁，有着较好的注释，结构也组织的不错——因为你知道会有人来检查你的代码，而且你很在意他们的意见。如果没有代码审查，你知道代码会在最后才会审查。因为不是马上就要检查，所以对你而言并不紧迫，因而你不会想着先自检一遍。   

**代码审查还有一个更大的好处，就是可以分享知识。**在很多的开发团队中，每个人都会负责并且专注于一个核心模块。除非别的同事负责的模块出现问题导致自己的代码不能运行，否则他们是不会去关注别人的工作。这样产生的结果是，每一个模块的代码只有一个人比较熟悉。假如事不凑巧，那位程序员正好休假或者离开了公司，那么没有人了解那些代码了。如果有代码审查的环节，那么至少会有两个人熟悉代码——代码的作者和审阅者。审阅者虽然没有作者对代码那么了解——但是他同样熟悉代码的设计和结构，这些信息是无价之宝。   

 当然，没有什么事情是那么简单的。以我的的经验看来，要做好代码审查需要一段时间练习。我注意到经验不足的审阅者通常会落入一些代码审查的陷阱，这些陷阱往往会造成很多的麻烦，给那些希望尝试代码审查的人们留下了坏印象，成为了他们采纳代码审查的一个主要障碍。   

 代码审查最重要规则是对即将提交的代码中查找问题——**你需要做的就是确认代码是正确的**。而通常会犯的一个错误，也是刚刚接触代码审查的新手容易犯的一个错误，即审阅者会判断这段代码是否按照自己思路来实现。   

 当有一个问题需要解决时，通常会有几十种的办法。当选定一个解决方法时，会有百万种代码实现。因此，作为一个审阅者，你的工作不是确保代码是按照你的方式来编写的——因为这是不可能的事情。审阅者的工作是确保原作者编写的代码是正确的。如果你没有遵守这个规则，你可能会到处碰壁，审查结束时你的心情很糟糕，对你来说肯定不是一件好事情。   

 问题在于这是不自觉就会犯的一个错误。假定你是一个程序员，当你在看一个问题的时候，你会得到一个自己的解决方案——并且你认为你看到的就是这个问题（应该采用的）解决办法。如果想要成为一名好的审查者，你需要知道这是不对的。   

**第二个误区就是人们感觉一定要说点什么（才算是做了代码审查）**。代码的作者花了很多的时间和精力来编写代码——你难道不应该说点什么吗？   

 答案是：你不应该。   

 如果只是说“哦，这看起来这不错！”，这永远没错。反之，如果你不断地去查找一些“问题”并加以指责，那么我肯定你的信誉会荡然无存。如果你不断地去制造一些事情来说些什么，那么代码的作者会认为，当你的言论只是为了避免冷场。从此，你的意见不会受到重视。   

**第三个误区就是速度。**你不应该匆忙完成一次代码审查——但是也不要拖延。你的同事在那里等着你的审查结果。如果你和同事不愿意抽出时间来做代码审查或者一直拖延，大家会对这次的审查感到厌烦，也会认为以后的代码审查也只会带来麻烦。看起来好像代码审查会打断你的工作，其实不必如此。你不必要在别人要求你审查的时候马上丢掉手头上的事情。但是在几个小时之内，当你工作中间休息的时候——喝杯茶，去一下洗手间或者聊聊天，散散步。当你再回来工作的时候，你可以开始并完成这个代码审查。如果你这么做了，没有人会站在你身边一直等着你给出审查结果。   

 译文出处：[伯乐](http://www.jobbole.com/)在线 - [职场](http://www.jobbole.com/blog.php)[博客](http://www.jobbole.com/blog.php/287) - [程序员](http://www.jobbole.com/blog.php/287)   

 译文链接：[http://www.jobbole.com/entry.php/1171](http://www.jobbole.com/entry.php/1171)   

 原文：[MarkCC](http://scientopia.org/blogs/goodmath/2011/07/06/things-everyone-should-do-code-review/) 译文：敏捷[翻译](http://www.jobbole.com/blog.php/413) - **[唐尤华**](http://www.jobbole.com/member.php/3001-%E5%94%90%E5%B0%A4%E5%8D%8E)